# -*- coding: utf-8 -*-
import config
import telebot
from telebot import types

bot = telebot.TeleBot(config.token)

@bot.message_handler(commands=["start"])
def start(message):
    bot.send_message(message.chat.id, '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é. \n\n –û—Ç–ø—Ä–∞–≤—å—Ç–µ /help –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏.')

@bot.message_handler(commands=["help"])
def helps(message):
    bot.send_message(message.chat.id, '–ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –æ–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º —à–∫–æ–ª—å–Ω–æ–≥–æ —á–∞—Ç–∞')

@bot.message_handler(commands=["—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ"])
@bot.message_handler(regexp="^—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ$")
def send_rasp(message):
    bot.send_photo(config.chat, open('raspisanie.jpg', 'rb'))


"""
@bot.message_handler(commands=['w', '–ø'])
@bot.message_handler(regexp="^.–ø$")
def send_weather(message):
    # get temperature ORSK
    r = requests.get(own_link)
    if r.status_code == 200:
        doc = xmltodict.parse(r.text)
        value = doc['current']['temperature']['@value']
        print('ORSK T:' + value)
        bot.send_message(message.chat.id, 'ORSK T: ' + value)
    else:
        bot.send_message(message.chat.id, u"cannot get content of ( URL: {own_link})... ERROR:" + str(r.status))
"""

@bot.message_handler(content_types=["text"])
def messages(message):
    if int(message.chat.id) == int(config.chat):
        try:
            chatId=message.text.split(': ')[0]
            text=message.text.split(': ')[1]
            bot.send_message(chatId, text)
        except:
            pass
    else:
        # –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–µ —Ç–µ–º —á–µ–ª–æ–≤–µ–∫–æ–º - –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –µ–≥–æ –Ω–∏–∫
        if message.chat.id == int(config.sender_id):
            sender_name = config.sender_name
        else:
            sender_name = str(message.chat.username)

        bot.send_message(config.chat, f"*{sender_name}*: {message.text}", parse_mode = 'Markdown')
        bot.send_message(message.chat.id, f"*{message.chat.username}* –∏–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∞ üëç", parse_mode = 'Markdown')

@bot.message_handler(content_types=["photo"])
def get_photo(message):

    if message.chat.id == int(config.sender_id):
        sender_name = config.sender_name
    else:
        sender_name = str(message.chat.username)

    photo = message.photo[-1].file_id
    bot.send_photo(config.chat, photo, f"*{sender_name}*: {message.caption}", parse_mode='Markdown')
    bot.send_message(message.chat.id, f"*{message.chat.username}*, —Ñ–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ.", parse_mode = 'Markdown')


@bot.message_handler(content_types=["document"])
def command_doc(message):
#        bot.send_message(config.chat, sender_name + ': ' + message.text)
    bot.send_message(message.chat.id, "–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞.")

if __name__ == '__main__':
    bot.polling(none_stop = True)
